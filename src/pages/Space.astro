<script>
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { createStars } from '../components/startField.js';

    const wScreen = window.innerWidth;
    const hScreen = window.innerHeight;
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, wScreen / hScreen, 0.1, 1000);
    camera.position.z = 4;

    const renderer = new THREE.WebGLRenderer({
        antialias: true,
    });

    renderer.setSize(wScreen, hScreen);
    document.body.appendChild(renderer.domElement);

    new OrbitControls(camera, renderer.domElement);

    // -------
    
    const loader = new THREE.TextureLoader();

    const earthTexture = "/textures/earth_day.webp";
    const earthTextureNight = "/textures/earth_night.webp";
    const earthTextureClouds = "/textures/earth_clouds.webp";

    const stars = createStars(scene);

    // -------

    const earthGroup = new THREE.Group();
    earthGroup.rotation.z = -23.4 * Math.PI / 180;
    scene.add(earthGroup);

    const earthGeometry = new THREE.IcosahedronGeometry(1, 12);
    const earthMaterial = new THREE.MeshPhongMaterial({
        map: loader.load(earthTexture)
    });
    const earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);
    earthGroup.add(earthMesh);


    const lightsMaterial = new THREE.MeshBasicMaterial({
        map: loader.load(earthTextureNight),
        blending: THREE.AdditiveBlending,
    });
    const lightsMesh = new THREE.Mesh(earthGeometry, lightsMaterial);
    earthGroup.add(lightsMesh);


    const cloudMaterial = new THREE.MeshBasicMaterial({
        map: loader.load(earthTextureClouds),
        blending: THREE.AdditiveBlending,
        opacity: 0.3,
        transparent: true,
    })
    const cloudMesh = new THREE.Mesh(earthGeometry, cloudMaterial);
    cloudMesh.scale.setScalar(1.003);
    earthGroup.add(cloudMesh);

    // -------

    const sunLight = new THREE.DirectionalLight(0xffffff, 0.6);
    sunLight.position.set(-2, 0.5, 1.5);
    scene.add(sunLight);

    function render() {
        requestAnimationFrame(render);

        earthMesh.rotation.y += 0.002;
        lightsMesh.rotation.y += 0.002;
        cloudMesh.rotation.y += 0.003;
        stars.rotation.y += 0.0009;

        renderer.render(scene, camera)
    }

    render();
    
</script>
